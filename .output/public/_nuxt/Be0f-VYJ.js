import{e as ee,j as te,V as oe,a1 as ae,U as ne,f as y,a3 as re,u as se,x as M,T as ie,m as le,l as ce,H as ue,r as p,n as P,o as x,b as f,a as s,t as v,h as u,w as c,S as de,d as k,p as I,c as pe,g as $,W as fe}from"./BNTQV3vS.js";import{u as ve,p as F}from"./DBkmor_s.js";import{p as B}from"./CDH_btW_.js";import{_ as me}from"./DlAUqK2U.js";const ye={class:"py-5 px-3 px-md-0"},he={class:"mb-5 mb-md-8 text-center"},_e={class:"d-flex phone"},ge={class:"text-center pt-5"},be={key:1,class:"mt-5"},we={class:"d-flex flex-wrap gap-10"},Ce={class:"mt-4"},xe={key:2,class:"mt-5"},ke=ee({__name:"[[number]]",setup(Pe){const{t:a,locale:$e}=te(),H=oe(),h=ae(),O=ne(),{addSearchToHistory:q,initializeStorage:J}=ve(),m=y(!1);y(!1);const d=y(""),i=y({code:"",countryWithCode:"",countryTranslated:""}),r=y(null),w=y(null),C=y(!1),b=re.useReCaptcha(),{$api:V}=se(),W=M(()=>{if(!i.value||!d.value)return!1;const e=i.value.code+d.value.trim(),t=F("+"+e);return t?t.isValid():!1}),N=M(()=>B.map(e=>({...e,countryWithCode:`${a(`country.${e.country}`)||e.country} (+${e.code})`,countryTranslated:a(`country.${e.country}`)||e.country}))),j=(e,t)=>{if(!e||!e.countryWithCode)return!1;const o=t.toLowerCase();return e.countryWithCode.toLowerCase().includes(o)||e.countryTranslated.toLowerCase().includes(o)||e.code.includes(o)},R=e=>JSON.stringify(e,null,2),S=async()=>(await(b==null?void 0:b.recaptchaLoaded()),await(b==null?void 0:b.executeRecaptcha("verification"))),z=async()=>{if(i.value.code&&d.value){const e=`${i.value.code}${d.value}`;if(h.params.number===e){await T();return}await H.push(O(`/verification/${e}`))}},Q=async()=>{var t,o;m.value=!0,w.value=null,C.value=!1;try{const n=await S();if(!n)throw new Error("Failed to get ReCaptcha token");const l=(t=r.value)==null?void 0:t.phoneNumber;if(!l)throw new Error("No phone number found in verification response");const _=await V.get(`/api/verification/${l}?token=${n}&reset=1`);r.value=_.data,C.value=!0}catch(n){console.error("Reset verification error:",n),(o=n.message)!=null&&o.includes("ReCaptcha")?r.value={error:"ReCaptcha verification failed. Please refresh the page and try again."}:r.value={error:(n==null?void 0:n.message)||"Unknown error"}}finally{m.value=!1}},T=async(e=0)=>{var t;m.value=!0,r.value=null,w.value=null,C.value=!1;try{const o=await S();if(!o)throw new Error("Failed to get ReCaptcha token");const n=i.value.code+d.value.trim(),l=await V.get(`/api/verification/${n}?token=${o}&reset=${e}`);r.value=l.data,C.value=!0,r.value&&!r.value.error&&await q(n,{...r.value,type:"verification",phone:n,isBusiness:!1,isEnterprise:!1})}catch(o){console.error("Send verification error:",o),(t=o.message)!=null&&t.includes("ReCaptcha")?r.value={error:"ReCaptcha verification failed. Please refresh the page and try again."}:r.value={error:(o==null?void 0:o.message)||"Unknown error"}}finally{m.value=!1}},D=e=>{if(!e)return"info";switch(e.toLowerCase()){case"pending":return"warning";case"verified":return"success";case"failed":case"expired":return"error";default:return"info"}},G=y(null);ie(()=>{var n,l;const e=a("verification.title")+" | WhatsApp Profile API",t=a("verification.infoMessage")+" "+a("verification.title")+" - WhatsApp Profile API.",o=`${fe}/verification/${h.params.number||""}`;return{title:e,meta:[{name:"description",content:a("verification.infoMessage")},{property:"og:title",content:a("verification.title")+" | WhatsApp Profile API"},{property:"og:description",content:a("verification.infoMessage")},{property:"og:type",content:"website"},{property:"og:url",content:o},{property:"og:site_name",content:"WhatsApp Profile API"},{property:"og:image",content:"/web-app-manifest-512x512.png"},{name:"twitter:card",content:"summary_large_image"},{name:"twitter:title",content:e},{name:"twitter:description",content:t},{name:"twitter:image",content:"/web-app-manifest-512x512.png"},{name:"robots",content:"index, follow"},{name:"language",content:h.params.lang||"en"}],link:[{rel:"canonical",href:o}],script:[{type:"application/ld+json",innerHTML:JSON.stringify({"@context":"https://schema.org","@type":"WebPage",name:e,description:t,url:o,inLanguage:h.params.lang||"en",isPartOf:{"@type":"WebSite",name:"WhatsApp Profile API",url:(l=(n=G.value)==null?void 0:n.public)==null?void 0:l.siteUrl},mainEntity:{"@type":"FAQPage",mainEntity:[{"@type":"Question",name:a("verification.title"),acceptedAnswer:{"@type":"Answer",text:a("verification.infoMessage")}}]}})}]}}),le(async()=>{{await J();const e=h.params.number;if(e&&await K(e),!d.value){const t={code:"598",countryWithCode:`${a("country.Uruguay")} (+598)`,countryTranslated:a("country.Uruguay")},o=localStorage.getItem("phoneCode");if(o)try{i.value=N.value.find(n=>n.code===JSON.parse(o).code)||t}catch{i.value=t}else i.value=t;m.value=!1}}}),ce(i,e=>{e&&localStorage.setItem("phoneCode",JSON.stringify(e))});const K=async e=>{try{const t=F("+"+e);t&&t.isValid()&&(i.value={code:t.countryCallingCode,countryWithCode:`${a(`country.${t.country}`)} (+${t.countryCallingCode})`,countryTranslated:a(`country.${t.country}`)||t.country},d.value=t.nationalNumber,ue(()=>{T(h.query.reset?parseInt(h.query.reset,10):0)}))}catch(t){console.error("Error parsing phone number:",t);const o=e;if(o.length>3){const n=[o.slice(0,1),o.slice(0,2),o.slice(0,3)];for(const l of n)if(B.some(_=>_.code===l)){i.value={code:l,countryTranslated:"",countryWithCode:""},d.value=o.slice(l.length);break}}}};return(e,t)=>{const o=p("v-list-item"),n=p("v-autocomplete"),l=p("v-text-field"),_=p("v-btn"),X=p("v-form"),A=p("v-alert"),L=p("v-col"),E=p("v-textarea"),Y=p("v-row"),Z=p("v-container");return x(),P("div",ye,[f("h1",he,v(u(a)("verification.title")),1),s(X,{onSubmit:I(z,["prevent"])},{default:c(()=>[f("div",_e,[s(n,{"return-object":"",disabled:m.value,variant:"outlined","hide-details":"",required:"",modelValue:i.value,"onUpdate:modelValue":t[0]||(t[0]=g=>i.value=g),class:"phone--code",filter:j,"max-width":"118px","item-title":"countryWithCode",autocomplete:"off","data-lpignore":"true","data-form-type":"other",label:u(a)("lookup.country"),items:N.value},{selection:c(({item:g})=>[f("span",null,"+"+v(g.raw.code),1)]),item:c(({props:g,item:U})=>[s(o,de(g,{title:U.raw.countryWithCode,subtitle:"+"+U.raw.code}),null,16,["title","subtitle"])]),_:1},8,["disabled","modelValue","label","items"]),s(l,{disabled:m.value,modelValue:d.value,"onUpdate:modelValue":t[1]||(t[1]=g=>d.value=g),autocomplete:"off","data-lpignore":"true","data-form-type":"other",class:"phone--number",variant:"outlined",tile:"",type:"tel","hide-details":"",label:u(a)("verification.inputLabel"),required:""},null,8,["disabled","modelValue","label"])]),f("div",ge,[s(_,{disabled:!W.value,type:"submit",loading:m.value,size:"large",color:"primary"},{default:c(()=>[k(v(u(a)("verification.button")),1)]),_:1},8,["disabled","loading"])])]),_:1}),s(Z,null,{default:c(()=>[W.value?$("",!0):(x(),pe(A,{key:0,class:"text-body-2 alert-send-button mx-auto mt-5",type:"info",text:u(a)("verification.infoMessage"),density:"compact"},null,8,["text"])),r.value?(x(),P("div",be,[s(Y,null,{default:c(()=>[s(L,{cols:"12",md:"6"},{default:c(()=>[f("div",we,[s(_,{color:"primary",target:"_blank",link:"",href:r.value.whatsappLink},{default:c(()=>[k(v(u(a)("verification.verifyLink")),1)]),_:1},8,["href"]),s(_,{onClick:I(Q,["prevent"]),color:"secondary"},{default:c(()=>[k(v(u(a)("verification.reset")),1)]),_:1})]),f("div",Ce,[s(A,{type:D(r.value.status),border:"start",prominent:"",class:"text-body-1"},{title:c(()=>[k(v(u(a)("verification.statusTitle")),1)]),default:c(()=>[f("span",null,v(r.value.status||u(a)("verification.status.unknown")),1)]),_:1},8,["type"])])]),_:1}),s(L,{cols:"12",md:"6"},{default:c(()=>[f("h3",null,v(u(a)("verification.responseTitle")),1),s(E,{rows:"10","model-value":R(r.value),readonly:""},null,8,["model-value"])]),_:1})]),_:1})])):$("",!0),w.value?(x(),P("div",xe,[f("h3",null,v(u(a)("verification.statusResponseTitle")),1),s(E,{rows:"10","model-value":R(w.value),readonly:""},null,8,["model-value"])])):$("",!0)]),_:1})])}}}),Se=me(ke,[["__scopeId","data-v-883b7df9"]]);export{Se as default};
