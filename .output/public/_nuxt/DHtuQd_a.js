import{u as ae,p as ne}from"./BLD0pdyR.js";import{e as se,j as re,U as ie,f as I,K as de,T as ce,x as v,W as ue,m as _e,r as i,c as y,o as c,w as t,b as d,n as p,g as f,a as o,t as s,h as a,d as r,Q as me,R as fe}from"./CRyLGsn1.js";import{_ as pe}from"./DlAUqK2U.js";const ve={class:"mb-5 mb-md-8 text-center"},ye={key:0,class:"text-center py-10"},he={class:"mt-4"},ge={key:2,class:"text-center py-10"},xe={class:"mt-4 mb-2"},be={class:"mb-4"},we={key:3,class:"mb-5"},ke={key:4},Ce={class:"position-relative w-100"},Ie={class:"image-overlay d-flex justify-space-between pa-2"},$e={class:"d-flex"},Ne={class:"d-flex justify-space-between align-center w-100"},ze={class:"text-h6"},Ve={class:"d-flex align-center mb-2"},De={class:"text-caption"},je={key:0},Se={key:0,class:"mb-1"},Le={key:1,class:"mb-1 text-truncate"},He={class:"d-flex gap-2 mt-2"},Ue={key:1,class:"text-error"},Ae={key:0},Be={class:"mb-2"},Pe={class:"d-flex align-center justify-center fill-height"},Te={class:"d-flex align-center justify-center fill-height"},Fe=se({__name:"history",setup(Me){const{t:n,locale:H}=re(),U=ie(),{searchHistory:h,loading:$,error:N,initializeStorage:M,loadSearchHistory:E,clearAllHistory:J,deleteSearchItem:K,downloadImage:A}=ae(),x=I(!1),b=de({}),w=I(""),k=I(!1),g=I({url:"",phoneNumber:""}),O=`${ue}/${H}/history`;ce({title:v(()=>n("history.title")+" - "+n("meta.suffix")),meta:[{name:"description",content:v(()=>n("history.meta.description"))},{property:"og:type",content:"website"},{property:"og:site_name",content:v(()=>n("meta.siteName"))},{property:"og:title",content:v(()=>n("history.title")+" - "+n("meta.suffix"))},{property:"og:description",content:v(()=>n("history.meta.description"))},{property:"og:url",content:O},{name:"twitter:title",content:v(()=>n("history.title")+" - "+n("meta.suffix"))},{name:"twitter:description",content:v(()=>n("history.meta.description"))},{name:"twitter:card",content:"summary_large_image"},{name:"robots",content:"noindex, nofollow"},{name:"language",content:v(()=>H.value)}]});const B=_=>{try{const e=ne("+"+_);return(e==null?void 0:e.formatInternational())||`+${_}`}catch{return`+${_}`}},Q=_=>{if(!_)return"";const m=new Date().getTime()-_.getTime(),u=Math.floor(m/(1e3*60*60*24));return u===0?_.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):u===1?n("history.yesterday"):u<7?n("history.daysAgo",{count:u}):_.toLocaleDateString()},R=async()=>{x.value=!1,await J()},W=(_,e)=>{g.value={url:_,phoneNumber:e},k.value=!0},q=v(()=>{if(!w.value)return h.value;const _=w.value.toLowerCase();return h.value.filter(e=>e.phoneNumber.includes(_)||e.data.about&&e.data.about.toLowerCase().includes(_)||e.data.pushname&&e.data.pushname.toLowerCase().includes(_))});return _e(async()=>{await M(),await E()}),(_,e)=>{const m=i("v-icon"),u=i("v-btn"),P=i("v-progress-circular"),G=i("v-alert"),X=i("v-text-field"),T=i("v-img"),z=i("v-chip"),V=i("v-card-title"),C=i("v-card-text"),D=i("v-spacer"),j=i("v-card-actions"),Y=i("v-divider"),Z=i("v-textarea"),ee=i("v-expand-transition"),S=i("v-card"),te=i("v-col"),oe=i("v-row"),F=i("v-dialog"),le=i("v-container");return c(),y(le,null,{default:t(()=>[d("div",ve,[d("h1",null,s(a(n)("history.title")),1),a(h).length>0?(c(),y(u,{key:0,class:"mt-3",color:"error",variant:"outlined",loading:a($),onClick:e[0]||(e[0]=l=>x.value=!0)},{default:t(()=>[o(m,{left:""},{default:t(()=>e[8]||(e[8]=[r("mdi-delete")])),_:1,__:[8]}),r(" "+s(a(n)("history.clearAll")),1)]),_:1},8,["loading"])):f("",!0)]),a($)&&a(h).length===0?(c(),p("div",ye,[o(P,{indeterminate:"",color:"primary",size:"64"}),d("p",he,s(a(n)("history.loading")),1)])):f("",!0),a(N)?(c(),y(G,{key:1,type:"error",class:"mb-5",dismissible:"","onClick:close":e[1]||(e[1]=l=>N.value=null)},{default:t(()=>[r(s(a(N)),1)]),_:1})):f("",!0),!a($)&&a(h).length===0?(c(),p("div",ge,[o(m,{size:"64",color:"grey"},{default:t(()=>e[9]||(e[9]=[r("mdi-history")])),_:1,__:[9]}),d("h3",xe,s(a(n)("history.empty.title")),1),d("p",be,s(a(n)("history.empty.description")),1),o(u,{color:"primary",to:a(U)("/")},{default:t(()=>[r(s(a(n)("history.empty.searchNow")),1)]),_:1},8,["to"])])):f("",!0),a(h).length>0?(c(),p("div",we,[o(X,{modelValue:w.value,"onUpdate:modelValue":e[2]||(e[2]=l=>w.value=l),"prepend-inner-icon":"mdi-magnify",label:a(n)("history.filter.placeholder"),variant:"outlined",clearable:"",density:"compact",class:"mx-auto",style:{"max-width":"500px"}},null,8,["modelValue","label"])])):f("",!0),a(h).length>0?(c(),p("div",ke,[o(oe,null,{default:t(()=>[(c(!0),p(me,null,fe(a(q),l=>(c(),y(te,{key:l.id,cols:"12",md:"6",lg:"4"},{default:t(()=>[o(S,{class:"history-card d-flex flex-column h-100",elevation:"3"},{default:t(()=>[d("div",Ce,[o(T,{src:l.urlImage||"/placeholder.jpg",height:"200",class:"grey lighten-2",cover:""},{default:t(()=>[d("div",Ie,[l.urlImage?(c(),y(u,{key:0,icon:"",size:"small",color:"white",onClick:L=>W(l.urlImage,l.phoneNumber)},{default:t(()=>[o(m,null,{default:t(()=>e[10]||(e[10]=[r("mdi-magnify-plus")])),_:1,__:[10]})]),_:2},1032,["onClick"])):f("",!0),d("div",$e,[l.urlImage?(c(),y(u,{key:0,icon:"",size:"small",color:"white",class:"mr-2",onClick:L=>a(A)(l.urlImage,`${l.phoneNumber}_profile.jpeg`)},{default:t(()=>[o(m,null,{default:t(()=>e[11]||(e[11]=[r("mdi-download")])),_:1,__:[11]})]),_:2},1032,["onClick"])):f("",!0),o(u,{icon:"",size:"small",color:"error",onClick:L=>a(K)(l.id)},{default:t(()=>[o(m,null,{default:t(()=>e[12]||(e[12]=[r("mdi-delete")])),_:1,__:[12]})]),_:2},1032,["onClick"])])])]),_:2},1032,["src"])]),o(V,{class:"pb-2"},{default:t(()=>[d("div",Ne,[d("span",ze,s(B(l.phoneNumber)),1),o(z,{color:l.data.error?"error":"success",size:"small",variant:"flat"},{default:t(()=>[r(s(l.data.error?a(n)("history.failed"):a(n)("history.success")),1)]),_:2},1032,["color"])])]),_:2},1024),o(C,{class:"pt-0"},{default:t(()=>[d("div",Ve,[o(m,{size:"small",class:"mr-2"},{default:t(()=>e[13]||(e[13]=[r("mdi-clock-outline")])),_:1,__:[13]}),d("span",De,s(Q(l.searchDate)),1)]),l.data.error?(c(),p("div",Ue,[o(m,{size:"small",class:"mr-1"},{default:t(()=>e[14]||(e[14]=[r("mdi-alert-circle")])),_:1,__:[14]}),r(" "+s(a(n)(l.data.error)||l.data.error),1)])):(c(),p("div",je,[l.data.pushname?(c(),p("div",Se,[d("strong",null,s(a(n)("lookup.name"))+":",1),r(" "+s(l.data.pushname),1)])):f("",!0),l.data.about?(c(),p("div",Le,[d("strong",null,s(a(n)("lookup.about"))+":",1),r(" "+s(l.data.about),1)])):f("",!0),d("div",He,[l.data.isBusiness?(c(),y(z,{key:0,size:"x-small",color:"blue",variant:"flat"},{default:t(()=>[r(s(a(n)("lookup.business")),1)]),_:1})):f("",!0),l.data.isEnterprise?(c(),y(z,{key:1,size:"x-small",color:"purple",variant:"flat"},{default:t(()=>[r(s(a(n)("lookup.enterprise")),1)]),_:1})):f("",!0)])]))]),_:2},1024),o(j,null,{default:t(()=>[o(u,{variant:"text",color:"primary",to:a(U)(`/${l.phoneNumber}`),size:"small"},{default:t(()=>[o(m,{left:"",size:"small"},{default:t(()=>e[15]||(e[15]=[r("mdi-magnify")])),_:1,__:[15]}),r(" "+s(a(n)("history.searchAgain")),1)]),_:2},1032,["to"]),o(D),o(u,{icon:"",variant:"text",size:"small",onClick:L=>b[l.id]=!b[l.id]},{default:t(()=>[o(m,null,{default:t(()=>[r(s(b[l.id]?"mdi-chevron-up":"mdi-chevron-down"),1)]),_:2},1024)]),_:2},1032,["onClick"])]),_:2},1024),o(ee,null,{default:t(()=>[b[l.id]?(c(),p("div",Ae,[o(Y),o(C,null,{default:t(()=>[d("h4",Be,s(a(n)("history.rawData")),1),o(Z,{"model-value":JSON.stringify(l.data,null,2),readonly:"",rows:"6",variant:"outlined",density:"compact",class:"raw-data"},null,8,["model-value"])]),_:2},1024)])):f("",!0)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})])):f("",!0),o(F,{modelValue:x.value,"onUpdate:modelValue":e[4]||(e[4]=l=>x.value=l),"max-width":"500"},{default:t(()=>[o(S,null,{default:t(()=>[o(V,{class:"text-h5"},{default:t(()=>[r(s(a(n)("history.confirmClear.title")),1)]),_:1}),o(C,null,{default:t(()=>[r(s(a(n)("history.confirmClear.message")),1)]),_:1}),o(j,null,{default:t(()=>[o(D),o(u,{color:"grey",variant:"text",onClick:e[3]||(e[3]=l=>x.value=!1)},{default:t(()=>[r(s(a(n)("history.confirmClear.cancel")),1)]),_:1}),o(u,{color:"error",variant:"text",onClick:R},{default:t(()=>[r(s(a(n)("history.confirmClear.confirm")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),o(F,{modelValue:k.value,"onUpdate:modelValue":e[7]||(e[7]=l=>k.value=l),"max-width":"800"},{default:t(()=>[o(S,null,{default:t(()=>[o(V,{class:"d-flex justify-space-between align-center"},{default:t(()=>[d("span",null,s(a(n)("history.fullImage.title"))+" "+s(B(g.value.phoneNumber)),1),o(u,{icon:"",variant:"text",onClick:e[5]||(e[5]=l=>k.value=!1)},{default:t(()=>[o(m,null,{default:t(()=>e[16]||(e[16]=[r("mdi-close")])),_:1,__:[16]})]),_:1})]),_:1}),o(C,{class:"pa-0"},{default:t(()=>[o(T,{src:g.value.url,alt:`Profile picture for ${g.value.phoneNumber}`,class:"w-100",style:{"max-height":"70vh"},contain:""},{placeholder:t(()=>[d("div",Pe,[o(P,{indeterminate:"",color:"primary"})])]),error:t(()=>[d("div",Te,[o(m,{size:"64",color:"grey"},{default:t(()=>e[17]||(e[17]=[r("mdi-image-broken")])),_:1,__:[17]})])]),_:1},8,["src","alt"])]),_:1}),o(j,null,{default:t(()=>[o(D),o(u,{color:"primary",variant:"outlined",onClick:e[6]||(e[6]=l=>a(A)(g.value.url,`${g.value.phoneNumber}_profile.jpeg`))},{default:t(()=>[o(m,{left:""},{default:t(()=>e[18]||(e[18]=[r("mdi-download")])),_:1,__:[18]}),r(" "+s(a(n)("history.fullImage.download")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})}}}),Oe=pe(Fe,[["__scopeId","data-v-4f315b90"]]);export{Oe as default};
