import{d as e,h as r,i as t,g as i}from"../../../_/nitro.mjs";import o from"axios";import{a,u as s}from"../../../_/apiKeyService.mjs";import{I as p}from"../../../_/ipRateLimiterService.mjs";import"fs";import"os";import"path";import"url";import"http";import"https";import"events";import"zlib";import"@fastify/busboy";import"jsonwebtoken";import"node-forge";import"crypto";import"jwks-rsa";import"bcryptjs";import"mongoose";import"lru-cache";import"@unocss/core";import"@unocss/preset-wind3";import"devalue";import"consola";import"unhead";import"node:http";import"node:https";import"node:events";import"node:buffer";import"vue";import"node:fs";import"node:url";import"unhead/server";import"unhead/plugins";import"unhead/utils";import"vue-bundle-renderer/runtime";import"vue/server-renderer";import"node:path";import"node:crypto";const n="6LcTNcMUAAAAADEpxYQ1v20gTFN4h4nHfC1kJqCs",u=e((async e=>{var u,m,d;try{const c=(null==(u=e.node.req.headers["x-forwarded-for"])?void 0:u.toString().split(",")[0])||e.node.req.socket.remoteAddress||"unknown",l=await r(e),h=new p(l.success),q=await h.canMakeRequest(c),f=t(e,"number"),v=i(e).token;if(!q){if(l.success&&l.user){const e=await a(l.user.uid);if(e.success&&e.apiKey&&v){const r=`https://www.google.com/recaptcha/api/siteverify?secret=${n}&response=${v}`;if(!(await o.post(r).then((e=>e.data))).success)return{error:"Invalid token"};try{const r=`https://whatsapp-data1.p.rapidapi.com/number/${f}`,t=await o.get(r,{headers:{"x-rapidapi-host":"whatsapp-data1.p.rapidapi.com","x-rapidapi-key":e.apiKey}}),i=t.headers,a={requestLimit:i["x-ratelimit-request-limit"]?parseInt(i["x-ratelimit-request-limit"]):void 0,requestRemaining:i["x-ratelimit-request-remaining"]?parseInt(i["x-ratelimit-request-remaining"]):void 0,requestReset:i["x-ratelimit-request-reset"]?parseInt(i["x-ratelimit-request-reset"]):void 0,quotaRequests:i["x-rapidapi-quota-requests"]?parseInt(i["x-rapidapi-quota-requests"]):void 0,quotaRequestsRemaining:i["x-rapidapi-quota-requests-remaining"]?parseInt(i["x-rapidapi-quota-requests-remaining"]):void 0};return await s(l.user.uid,a).catch((e=>{console.error("Failed to update rate limit info:",e)})),t.data}catch(e){return console.error("RapidAPI request failed:",e),{error:(null==(d=null==(m=e.response)?void 0:m.data)?void 0:d.message)||"RapidAPI request failed"}}}}return{error:"lookup.rateLimit"}}if(v){const e=`https://www.google.com/recaptcha/api/siteverify?secret=${n}&response=${v}`;if((await o.post(e).then((e=>e.data))).success){const e=`http://104.234.204.107:3728/number/${f}?bypass992=true&ip=${c}`,r=await o.get(e).then((e=>e.data));return(null==r?void 0:r.error)||(null==r?void 0:r._id)||await h.incrementSuccessfulRequest(c),r}return{error:"Invalid token"}}return{error:"No token"}}catch(e){return console.error("Error in phone lookup handler:",e),{error:"An unexpected error occurred"}}}));export{u as default};
//# sourceMappingURL=_number_.mjs.map
