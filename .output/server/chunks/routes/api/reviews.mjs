import{d as e,g as t}from"../../_/nitro.mjs";import"fs";import"os";import"path";import"url";import"http";import"https";import"events";import"zlib";import"@fastify/busboy";import"jsonwebtoken";import"node-forge";import"crypto";import"jwks-rsa";import"bcryptjs";import"mongoose";import"lru-cache";import"@unocss/core";import"@unocss/preset-wind3";import"devalue";import"consola";import"unhead";import"node:http";import"node:https";import"node:events";import"node:buffer";import"vue";import"node:fs";import"node:url";import"unhead/server";import"unhead/plugins";import"unhead/utils";import"vue-bundle-renderer/runtime";import"vue/server-renderer";import"node:path";import"node:crypto";const r=new Map,o=new Map;const i=e((async e=>{t(e);const i="whatsapp.checkleaked.cc",s=`reviews:${i}`,n=r.get(s);if(n&&(a=n,Date.now()-a.timestamp<3e5))return console.log(`[REVIEWS] Returning cached data for domain: ${i}`),n.data;var a;const c=o.get(s);if(c)return console.log(`[REVIEWS] Waiting for pending request for domain: ${i}`),await c;const p=async function(e){try{const t=`https://trustpilot.digitalshopuy.com/?domain=${e}`,r=await $fetch(t,{timeout:1e4}),o=r.reviews.map((e=>({id:e.id,rating:e.rating,title:e.title,text:e.text,author:e.consumer.displayName,country:e.consumer.countryCode,date:e.dates.publishedDate,isVerified:e.labels.verification.isVerified,source:e.source})));return{success:!0,data:{domain:r.domain,trustpilotUrl:r.pageUrl,businessName:r.businessUnit.displayName,totalReviews:r.businessUnit.numberOfReviews,averageRating:r.businessUnit.trustScore,ratingDistribution:r.filters.reviewStatistics.ratings,reviews:o}}}catch(e){return console.error("Error fetching reviews:",e),{success:!1,data:null,error:e instanceof Error?e.message:"Failed to fetch reviews"}}}(i);o.set(s,p);try{console.log(`[REVIEWS] Fetching fresh data for domain: ${i}`);const e=await p,t={data:e,timestamp:Date.now()};return r.set(s,t),console.log(`[REVIEWS] Cached data for domain: ${i}, success: ${e.success}`),e}catch(e){return console.error(`[REVIEWS] Error fetching reviews for domain: ${i}`,e),{success:!1,data:null,error:e instanceof Error?e.message:"Failed to fetch reviews"}}finally{o.delete(s)}}));export{i as default};
//# sourceMappingURL=reviews.mjs.map
