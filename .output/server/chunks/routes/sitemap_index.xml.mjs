import{B as e,C as t,D as s,E as o,F as a,G as n,H as i,I as r,J as m,K as p,L as c,j as l,d as u,u as d,M as h,N as f,k as g}from"../_/nitro.mjs";import"fs";import"os";import"path";import"url";import"http";import"https";import"events";import"zlib";import"@fastify/busboy";import"jsonwebtoken";import"node-forge";import"crypto";import"jwks-rsa";import"bcryptjs";import"mongoose";import"lru-cache";import"@unocss/core";import"@unocss/preset-wind3";import"devalue";import"consola";import"unhead";import"node:http";import"node:https";import"node:events";import"node:buffer";import"vue";import"node:fs";import"node:url";import"unhead/server";import"unhead/plugins";import"unhead/utils";import"vue-bundle-renderer/runtime";import"vue/server-renderer";import"node:path";import"node:crypto";const x=e((async(e,t,s,o)=>buildSitemapIndexInternal(t,s,o)),{name:"sitemap:index",group:"sitemap",maxAge:600,base:"sitemap",getKey:e=>{const t=l(e,"host")||l(e,"x-forwarded-host")||"";return`sitemap-index-${l(e,"x-forwarded-proto")||"https"}-${t}`},swr:!0});async function buildSitemapIndexInternal(e,t,s){const{sitemaps:l,autoLastmod:u,defaultSitemapsChunkSize:d,autoI18n:h,isI18nMapped:f,sortEntries:g,sitemapsPathPrefix:x}=t;if(!l)throw new Error("Attempting to build a sitemap index without required `sitemaps` configuration.");const v={},w=[];for(const e in l){if("index"===e||"chunks"===e)continue;const t=l[e];t.chunks||t._isChunking?(t._isChunking=!0,t._chunkSize="number"==typeof t.chunks?t.chunks:t.chunkSize||d||1e3):v[e]=v[e]||{urls:[]}}if(void 0!==l.chunks){const t=l.chunks;let r=await o();if(s&&e.event){const o={event:e.event,sitemapName:t.sitemapName,sources:r};await s.hooks.callHook("sitemap:sources",o),r=o.sources}const m=await a(r,e.event),p=m.filter((e=>e.error&&e._isFailure)).map((e=>({url:"string"==typeof e.fetch?e.fetch:e.fetch?.[0]||"unknown",error:e.error||"Unknown error"})));w.push(...p);const u={urls:m.flatMap((e=>e.urls)),sitemapName:t.sitemapName,event:e.event};await(s?.hooks.callHook("sitemap:input",u));const x=n(t,u.urls,{autoI18n:h,isI18nMapped:f},e).map((e=>i(e,t.defaults)));(k=x,g?c(k):k).forEach(((e,t)=>{const s=Math.floor(t/d);v[s]=v[s]||{urls:[]},v[s].urls.push(e)}))}var k;const S=[];for(const t in v){const s=v[t],o={_sitemapName:t,sitemap:e.canonicalUrlResolver(r(x||"",`/${t}.xml`))};let a=s.urls.filter((e=>!!e?.lastmod)).map((e=>"string"==typeof e.lastmod?new Date(e.lastmod):e.lastmod)).sort(((e,t)=>(t?.getTime()||0)-(e?.getTime()||0)))?.[0];!a&&u&&(a=new Date),a&&(o.lastmod=m(a)),S.push(o)}for(const t in l)if("index"!==t&&l[t]._isChunking){const i=l[t],c=i._chunkSize||d||1e3;let g=i.includeAppSources?await o():[];if(g.push(...await p(i)),s&&e.event){const t={event:e.event,sitemapName:i.sitemapName,sources:g};await s.hooks.callHook("sitemap:sources",t),g=t.sources}const v=await a(g,e.event),k=v.filter((e=>e.error&&e._isFailure)).map((e=>({url:"string"==typeof e.fetch?e.fetch:e.fetch?.[0]||"unknown",error:e.error||"Unknown error"})));w.push(...k);const y={urls:v.flatMap((e=>e.urls)),sitemapName:i.sitemapName,event:e.event};await(s?.hooks.callHook("sitemap:input",y));const I=n(i,y.urls,{autoI18n:h,isI18nMapped:f},e),M=I.length,b=Math.ceil(M/c);i._chunkCount=b;for(let s=0;s<b;s++){const o=`${t}-${s}`,a={_sitemapName:o,sitemap:e.canonicalUrlResolver(r(x||"",`/${o}.xml`))},n=I.slice(s*c,(s+1)*c);let i=n.filter((e=>!!e?.lastmod)).map((e=>"string"==typeof e.lastmod?new Date(e.lastmod):e.lastmod)).sort(((e,t)=>(t?.getTime()||0)-(e?.getTime()||0)))?.[0];!i&&u&&(i=new Date),i&&(a.lastmod=m(i)),S.push(a)}}return l.index&&S.push(...l.index.sitemaps.map((e=>"string"==typeof e?{sitemap:e}:e))),{entries:S,failedSources:w}}const v=u((async e=>{const o=d(),a=f(),n=h(e),{entries:i,failedSources:r}=await async function(e,t,s){return"number"==typeof t.cacheMaxAgeSeconds&&t.cacheMaxAgeSeconds>0&&e.event?x(e.event,e,t,s):buildSitemapIndexInternal(e,t,s)}(n,o,a),m={sitemaps:i,event:e};await a.hooks.callHook("sitemap:index-resolved",m);const p=r.length>0?{messages:r.map((e=>e.error)),urls:r.map((e=>e.url))}:void 0,c=function(e,o,{version:a,xsl:n,credits:i,minify:r},m){const p=e.map((e=>["    <sitemap>",`        <loc>${t(e.sitemap)}</loc>`,!!e.lastmod&&`        <lastmod>${t(e.lastmod)}</lastmod>`,"    </sitemap>"].filter(Boolean).join("\n"))).join("\n"),c=['<?xml version="1.0" encoding="UTF-8"?>'];if(n){let e=o.relativeBaseUrlResolver?.(n)??n;m&&m.messages.length>0&&(e=s(e,{errors:"true",error_messages:m.messages,error_urls:m.urls})),c.push(`<?xml-stylesheet type="text/xsl" href="${t(e)}"?>`)}return c.push('<sitemapindex xmlns="http://www.sitemaps.org/schemas/sitemap/0.9">',p,"</sitemapindex>"),i&&c.push(`\x3c!-- XML Sitemap Index generated by @nuxtjs/sitemap v${a} at ${(new Date).toISOString()} --\x3e`),r?c.join("").replace(/(?<!<[^>]*)\s(?![^<]*>)/g,""):c.join("\n")}(m.sitemaps,n,o,p),l={sitemap:c,sitemapName:"sitemap",event:e};if(await a.hooks.callHook("sitemap:output",l),g(e,"Content-Type","text/xml; charset=UTF-8"),o.cacheMaxAgeSeconds){g(e,"Cache-Control",`public, max-age=${o.cacheMaxAgeSeconds}, s-maxage=${o.cacheMaxAgeSeconds}, stale-while-revalidate=3600`);const t=new Date;g(e,"X-Sitemap-Generated",t.toISOString()),g(e,"X-Sitemap-Cache-Duration",`${o.cacheMaxAgeSeconds}s`);const s=new Date(t.getTime()+1e3*o.cacheMaxAgeSeconds);g(e,"X-Sitemap-Cache-Expires",s.toISOString());const a=Math.floor((s.getTime()-t.getTime())/1e3);g(e,"X-Sitemap-Cache-Remaining",`${a}s`)}else g(e,"Cache-Control","no-cache, no-store");return l.sitemap}));export{v as default};
//# sourceMappingURL=sitemap_index.xml.mjs.map
