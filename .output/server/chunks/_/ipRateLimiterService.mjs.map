{"version":3,"file":"ipRateLimiterService.mjs","sources":["../../../../server/models/IpRequest.ts","../../../../server/services/ipRateLimiterService.ts"],"sourcesContent":null,"names":["IpRequestSchema","Schema","ip","type","String","required","unique","count","Number","default","lastRequest","Date","now","windowStart","timestamps","index","expireAfterSeconds","ipModels","IpRateLimiterService","constructor","isAuth","collection","__publicField","this","RATE_LIMIT","IpRequest","mongoose","model","checkRateLimit","connectToMongoDB","getTime","WINDOW","ipRecord","findOne","error","console","getRequestCount","resp","max","restartsIn","Math","ceil","incrementSuccessfulRequest","findOneAndUpdate","$set","$cond","if","$or","$not","$lt","then","else","$add","upsert","new","setDefaultsOnInsert","canMakeRequest","cleanupOldRecords","cutoff","deleteMany"],"mappings":"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"}