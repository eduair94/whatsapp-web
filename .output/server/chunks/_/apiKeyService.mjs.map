{"version":3,"file":"apiKeyService.mjs","sources":["../../../../server/models/ApiKey.ts","../../../../server/services/apiKeyService.ts"],"sourcesContent":null,"names":["ApiKeySchema","Schema","userId","type","String","required","unique","index","trim","maxlength","encryptedApiKey","iv","authTag","apiKeyHash","lastSaved","Date","default","now","isActive","Boolean","metadata","userAgent","ipAddress","platform","rateLimitInfo","requestLimit","Number","min","requestRemaining","requestReset","lastUpdated","timestamps","collection","createdAt","pre","next","this","isModified","methods","toSafeObject","obj","toObject","statics","findByUserId","findOne","deactivateByUserId","updateOne","getActiveCount","countDocuments","cleanupInactive","daysOld","cutoffDate","setDate","getDate","deleteMany","updatedAt","$lt","ApiKey","mongoose","models","model","async","saveApiKey","apiKey","success","message","validation","validateApiKey","isValid","error","connectToMongoDB","encryptedData","encryptData","hashData","existingApiKey","save","newApiKey","console","getApiKey","apiKeyDoc","decryptData","decryptError","deleteApiKey","matchedCount","hasApiKey","hasKey","getApiKeyStats","oneDayAgo","activeCount","inactiveCount","recentCount","Promise","all","$gte","totalActiveKeys","totalInactiveKeys","recentlyUpdated","updateRateLimitInfo","$set"],"mappings":"iGA2BA,MAAMA,EAAe,IAAIC,EACvB,CACEC,OAAQ,CACNC,KAAMC,OACNC,UAAU,EACVC,QAAQ,EACRC,OAAO,EACPC,MAAM,EACNC,UAAW,KAEbC,gBAAiB,CACfP,KAAMC,OACNC,UAAU,EACVG,MAAM,GAERG,GAAI,CACFR,KAAMC,OACNC,UAAU,EACVG,MAAM,GAERI,QAAS,CACPT,KAAMC,OACNC,UAAU,EACVG,MAAM,GAERK,WAAY,CACVV,KAAMC,OACNC,UAAU,EACVG,MAAM,GAERM,UAAW,CACTX,KAAMY,KACNV,UAAU,EACVW,QAASD,KAAKE,IACdV,OAAO,GAETW,SAAU,CACRf,KAAMgB,QACNd,UAAU,EACVW,SAAS,EACTT,OAAO,GAETa,SAAU,CACRC,UAAW,CACTlB,KAAMC,OACNK,UAAW,KAEba,UAAW,CACTnB,KAAMC,OACNK,UAAW,IAEbc,SAAU,CACRpB,KAAMC,OACNK,UAAW,MAGfe,cAAe,CACbC,aAAc,CACZtB,KAAMuB,OACNC,IAAK,GAEPC,iBAAkB,CAChBzB,KAAMuB,OACNC,IAAK,GAEPE,aAAc,CACZ1B,KAAMuB,OACNC,IAAK,GAEPG,YAAa,CACX3B,KAAMY,KACNC,QAASD,KAAKE,OAIpB,CACEc,YAAY,EACZC,WAAY,aAKhBhC,EAAaO,MAAM,CAAEL,OAAQ,EAAGgB,SAAU,IAC1ClB,EAAaO,MAAM,CAAEO,WAAW,IAChCd,EAAaO,MAAM,CAAE0B,WAAW,IAGhCjC,EAAakC,IAAI,QAAQ,SAAUC,IAC7BC,KAAKC,WAAW,oBAAsBD,KAAKC,WAAW,iBACnDD,KAAAtB,cAAgBC,MAElBoB,GACP,IAGAnC,EAAasC,QAAQC,aAAe,WAC5B,MAAAC,EAAMJ,KAAKK,WAKV,cAJAD,EAAI9B,uBACJ8B,EAAI7B,UACJ6B,EAAI5B,eACJ4B,EAAI3B,WACJ2B,CACT,EAGAxC,EAAa0C,QAAQC,aAAe,SAAUzC,GAC5C,OAAOkC,KAAKQ,QAAQ,CAAE1C,SAAQgB,UAAU,GAC1C,EAEAlB,EAAa0C,QAAQG,mBAAqB,SAAU3C,GAClD,OAAOkC,KAAKU,UAAU,CAAE5C,UAAU,CAAEgB,UAAU,EAAOJ,UAAW,IAAIC,MACtE,EAEAf,EAAa0C,QAAQK,eAAiB,WACpC,OAAOX,KAAKY,eAAe,CAAE9B,UAAU,GACzC,EAEAlB,EAAa0C,QAAQO,gBAAkB,SAAUC,EAAkB,IAC3D,MAAAC,MAAiBpC,KAGvB,OAFAoC,EAAWC,QAAQD,EAAWE,UAAYH,GAEnCd,KAAKkB,WAAW,CACrBpC,UAAU,EACVqC,UAAW,CAAEC,IAAKL,IAEtB,EAGO,MAAMM,EAASC,EAASC,OAAOF,QAAUC,EAASE,MAAe,SAAU5D,GClH5D6D,eAAAC,WAAW5D,EAAgB6D,EAAgB3C,GAC3D,IAEF,IAAKlB,GAA4B,iBAAXA,EACpB,MAAO,CAAE8D,SAAS,EAAOC,QAAS,mBAG9B,MAAAC,EAAaC,EAAeJ,GAC9B,IAACG,EAAWE,QACd,MAAO,CAAEJ,SAAS,EAAOC,QAASC,EAAWG,OAAS,yBAIlDC,IAGA,MAAAC,cAAEA,KAAe5D,EAAIC,QAAAA,GAAY4D,EAAYT,EAAOvD,QACpDK,QAAmB4D,EAASV,EAAOvD,QAEnCS,MAAUF,KAGV2D,QAAuBjB,EAAOb,QAAQ,CAAE1C,WAE9C,GAAIwE,EAgBK,OAdHA,EAAehE,iBAAmB6D,IAEpCG,EAAelD,cAAgB,MAEjCkD,EAAehE,gBAAkB6D,EACjCG,EAAe/D,GAAKA,EACpB+D,EAAexD,UAAW,EAC1BwD,EAAe9D,QAAUA,EACzB8D,EAAe7D,WAAaA,EAC5B6D,EAAe5D,UAAYG,EAC3ByD,EAAetD,SAAWA,QAEpBsD,EAAeC,OAEd,CACLX,SAAS,EACTC,QAAS,+BACTnD,UAAW4D,EAAe5D,WAEvB,CAEC,MAAA8D,EAAY,IAAInB,EAAO,CAC3BvD,SACAQ,gBAAiB6D,EACjB5D,KACAC,UACAC,aACAC,UAAWG,EACXC,UAAU,EACVE,aAKK,aAFDwD,EAAUD,OAET,CACLX,SAAS,EACTC,QAAS,6BACTnD,UAAW8D,EAAU9D,UACvB,QAEKuD,GAEA,OADCQ,QAAAR,MAAM,0BAA2BA,GAClC,CACLL,SAAS,EACTC,QAAS,4CACX,CAEJ,CAKAJ,eAAsBiB,UAAU5E,GAC1B,IAEF,IAAKA,GAA4B,iBAAXA,EACpB,MAAO,CAAE8D,SAAS,EAAOC,QAAS,yBAI9BK,IAGA,MAAAS,QAAkBtB,EAAOb,QAAQ,CAAE1C,SAAQgB,UAAU,IAE3D,IAAK6D,EACI,MAAA,CACLf,SAAS,EACTC,QAAS,kCAIT,IAIK,MAAA,CACLD,SAAS,EACTD,OAJsBiB,EAAYD,EAAUrE,gBAAiBqE,EAAUpE,GAAIoE,EAAUnE,SAKrFE,UAAWiE,EAAUjE,UACrBU,cAAeuD,EAAUvD,qBAEpByD,GAEA,OADCJ,QAAAR,MAAM,8BAA+BY,GACtC,CACLjB,SAAS,EACTC,QAAS,uDACX,QAEKI,GAEA,OADCQ,QAAAR,MAAM,2BAA4BA,GACnC,CACLL,SAAS,EACTC,QAAS,gDACX,CAEJ,CAKAJ,eAAsBqB,aAAahF,GAC7B,IAEF,IAAKA,GAA4B,iBAAXA,EACpB,MAAO,CAAE8D,SAAS,EAAOC,QAAS,yBAI9BK,IAiBF,OAAwB,WAdPb,EAAOX,UAC1B,CAAE5C,SAAQgB,UAAU,GACpB,CACEA,UAAU,EACVJ,cAAeC,KAEfL,gBAAiB,GACjBC,GAAI,GACJC,QAAS,GACTC,WAAY,GACZW,cAAe,QAIR2D,aACF,CACLnB,SAAS,EACTC,QAAS,yCAIN,CACLD,SAAS,EACTC,QAAS,sCAEJI,GAEA,OADCQ,QAAAR,MAAM,4BAA6BA,GACpC,CACLL,SAAS,EACTC,QAAS,8CACX,CAEJ,CAKAJ,eAAsBuB,UAAUlF,GAC1B,IAEF,IAAKA,GAA4B,iBAAXA,EACb,MAAA,CAAEmF,QAAQ,SAIbf,IAGA,MAAAS,QAAkBtB,EAAOb,QAC7B,CAAE1C,SAAQgB,UAAU,GACpB,CAAEJ,UAAW,IAGR,MAAA,CACLuE,SAAUN,EACVjE,UAAsB,MAAXiE,OAAW,EAAAA,EAAAjE,iBAEjBuD,GAEA,OADCQ,QAAAR,MAAM,sCAAuCA,GAC9C,CAAEgB,QAAQ,EAAM,CAE3B,CAKAxB,eAAsByB,iBAKhB,UACIhB,IAEA,MAAAiB,MAAgBxE,KACtBwE,EAAUnC,QAAQmC,EAAUlC,UAAY,GAExC,MAAOmC,EAAaC,EAAeC,SAAqBC,QAAQC,IAAI,CAClEnC,EAAOT,eAAe,CAAE9B,UAAU,IAClCuC,EAAOT,eAAe,CAAE9B,UAAU,IAClCuC,EAAOT,eAAe,CACpB9B,UAAU,EACVJ,UAAW,CAAE+E,KAAMN,OAIhB,MAAA,CACLO,gBAAiBN,EACjBO,kBAAmBN,EACnBO,gBAAiBN,SAEZrB,GAEA,OADCQ,QAAAR,MAAM,iCAAkCA,GACzC,CACLyB,gBAAiB,EACjBC,kBAAmB,EACnBC,gBAAiB,EACnB,CAEJ,CAKsBnC,eAAAoC,oBAAoB/F,EAAgBsB,GACpD,IAEF,IAAKtB,GAA4B,iBAAXA,EACpB,MAAO,CAAE8D,SAAS,EAAOC,QAAS,yBAI9BK,IAeF,OAAwB,WAZPb,EAAOX,UAC1B,CAAE5C,UACF,CACEgG,KAAM,CACJ1E,cAAe,IACVA,EACHM,gBAAiBf,UAMdoE,aACF,CACLnB,SAAS,EACTC,QAAS,yCAIN,CACLD,SAAS,EACTC,QAAS,qDAEJI,GAEA,OADCQ,QAAAR,MAAM,oCAAqCA,GAC5C,CACLL,SAAS,EACTC,QAAS,0CACX,CAEJ"}